<div class="dashboard-layout">
  <!-- Sidebar -->
  <aside class="sidebar" [class.mobile-open]="isMobileMenuOpen">
    <div class="sidebar-header">
      <h2>ğŸ Shop Manager</h2>
      <button class="close-mobile-menu" (click)="closeMobileMenu()">âœ•</button>
    </div>

    <nav class="sidebar-nav">
      <ul>
        <li><a (click)="navigateToDashboard()" class="nav-link"><span class="icon">ğŸ </span><span>Trang chá»§</span></a></li>
        <li><a (click)="navigateToProducts()" class="nav-link"><span class="icon">ğŸ“¦</span><span>HÃ ng hÃ³a</span></a></li>
        <li><a (click)="navigateToCustomers()" class="nav-link"><span class="icon">ğŸ‘¥</span><span>KhÃ¡ch hÃ ng</span></a></li>
        <li><a (click)="navigateToPromotions()" class="nav-link active"><span class="icon">ğŸ</span><span>Khuyáº¿n mÃ£i</span></a></li>
        <li><a (click)="navigateToEmployees()" class="nav-link"><span class="icon">ğŸ‘¤</span><span>NhÃ¢n viÃªn</span></a></li>
        <li><a (click)="navigateToInvoices()" class="nav-link"><span class="icon">ğŸ§¾</span><span>HÃ³a Ä‘Æ¡n</span></a></li>
      </ul>
    </nav>
  </aside>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <button class="mobile-menu-btn" (click)="toggleMobileMenu()">â˜°</button>
        <h1>Quáº£n lÃ½ Khuyáº¿n mÃ£i</h1>
      </div>
      <div class="header-right">
        <button class="theme-toggle" (click)="changeTheme()">ğŸ¨ {{ getCurrentThemeLabel() }}</button>
        <app-notification-bell></app-notification-bell>
        <div class="user-menu">
          <img [src]="currentUser.avatar" alt="Avatar">
          <span>{{ currentUser.name }}</span>
          <button (click)="logout()" class="logout-btn">ÄÄƒng xuáº¥t</button>
        </div>
      </div>
    </header>

    <!-- Promotions Content -->
    <div class="promotions-container">
      <div class="header">
        <h1>ğŸ Quáº£n lÃ½ Khuyáº¿n mÃ£i</h1>
        <button class="btn-add" (click)="openAddDialog()">
          <span>â•</span> ThÃªm khuyáº¿n mÃ£i
        </button>
      </div>

      <div class="filters-section">
        <input 
          type="text" 
          placeholder="ğŸ” TÃ¬m kiáº¿m khuyáº¿n mÃ£i..." 
          [(ngModel)]="filters.searchText"
          (ngModelChange)="applyFilter()"
          class="search-input">
        
        <select [(ngModel)]="filters.promotionType" (ngModelChange)="applyFilter()" class="filter-select">
          <option value="">Táº¥t cáº£ loáº¡i</option>
          <option value="percentage">Giáº£m %</option>
          <option value="fixed">Giáº£m cá»‘ Ä‘á»‹nh</option>
          <option value="buy_x_get_y">Mua X táº·ng Y</option>
          <option value="free_shipping">Miá»…n phÃ­ ship</option>
        </select>

        <select [(ngModel)]="filters.status" (ngModelChange)="applyFilter()" class="filter-select">
          <option value="">Táº¥t cáº£ tráº¡ng thÃ¡i</option>
          <option value="active">Hoáº¡t Ä‘á»™ng</option>
          <option value="inactive">Táº¡m ngÆ°ng</option>
          <option value="expired">Háº¿t háº¡n</option>
        </select>

        <button class="btn-reset" (click)="resetFilters()">ğŸ”„ Reset</button>
      </div>

      <div class="promotions-grid" *ngIf="!isLoading">
        <div class="promotion-card" *ngFor="let promo of filteredPromotions">
          <div class="promotion-header">
            <h3>{{ promo.promotionName }}</h3>
            <span [class]="'status-badge status-' + promo.status">
              {{ getStatusLabel(promo.status) }}
            </span>
          </div>
          
          <div class="promotion-body">
            <p class="promotion-code">MÃ£: <strong>{{ promo.promotionCode }}</strong></p>
            <p class="promotion-type">{{ getPromotionTypeLabel(promo.promotionType) }}</p>
            <p class="promotion-value">Giáº£m: <strong>{{ promo.discountValue }}{{ promo.promotionType === 'percentage' ? '%' : 'Ä‘' }}</strong></p>
            <p class="promotion-dates">{{ promo.startDate | date:'dd/MM/yyyy' }} - {{ promo.endDate | date:'dd/MM/yyyy' }}</p>
            <p class="promotion-usage" *ngIf="promo.usageLimit">ÄÃ£ dÃ¹ng: {{ promo.usageCount }}/{{ promo.usageLimit }}</p>
          </div>

          <div class="promotion-actions">
            <button class="btn-edit" (click)="editPromotion(promo)">âœï¸ Sá»­a</button>
            <button class="btn-delete" (click)="deletePromotion(promo)">ğŸ—‘ï¸ XÃ³a</button>
          </div>
        </div>
      </div>

      <div class="loading" *ngIf="isLoading">â³ Äang táº£i...</div>
      <div class="no-data" *ngIf="!isLoading && filteredPromotions.length === 0">
        KhÃ´ng cÃ³ khuyáº¿n mÃ£i nÃ o.
      </div>

      <!-- Dialog thÃªm/sá»­a -->
      <div class="dialog-overlay" *ngIf="showDialog" (click)="closeDialog()">
        <div class="dialog" (click)="$event.stopPropagation()">
          <h2>{{ isEditMode ? 'âœï¸ Sá»­a khuyáº¿n mÃ£i' : 'â• ThÃªm khuyáº¿n mÃ£i' }}</h2>
          
          <div class="error-message" *ngIf="errorMessage">{{ errorMessage }}</div>

          <div class="form-group">
            <label>MÃ£ khuyáº¿n mÃ£i *</label>
            <input type="text" [(ngModel)]="currentPromotion.promotionCode" [disabled]="isEditMode">
          </div>

          <div class="form-group">
            <label>TÃªn khuyáº¿n mÃ£i *</label>
            <input type="text" [(ngModel)]="currentPromotion.promotionName">
          </div>

          <div class="form-group">
            <label>MÃ´ táº£</label>
            <textarea [(ngModel)]="currentPromotion.description" rows="3"></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Loáº¡i khuyáº¿n mÃ£i *</label>
              <select [(ngModel)]="currentPromotion.promotionType">
                <option value="percentage">Giáº£m %</option>
                <option value="fixed">Giáº£m cá»‘ Ä‘á»‹nh</option>
                <option value="buy_x_get_y">Mua X táº·ng Y</option>
                <option value="free_shipping">Miá»…n phÃ­ ship</option>
              </select>
            </div>

            <div class="form-group">
              <label>GiÃ¡ trá»‹ giáº£m *</label>
              <input type="number" [(ngModel)]="currentPromotion.discountValue">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>NgÃ y báº¯t Ä‘áº§u *</label>
              <input type="date" [(ngModel)]="currentPromotion.startDate">
            </div>

            <div class="form-group">
              <label>NgÃ y káº¿t thÃºc *</label>
              <input type="date" [(ngModel)]="currentPromotion.endDate">
            </div>
          </div>

          <div class="form-group">
            <label>Tráº¡ng thÃ¡i</label>
            <select [(ngModel)]="currentPromotion.status">
              <option value="active">Hoáº¡t Ä‘á»™ng</option>
              <option value="inactive">Táº¡m ngÆ°ng</option>
              <option value="expired">Háº¿t háº¡n</option>
            </select>
          </div>

          <div class="dialog-actions">
            <button class="btn-cancel" (click)="closeDialog()">Há»§y</button>
            <button class="btn-save" (click)="savePromotion()">{{ isEditMode ? 'Cáº­p nháº­t' : 'ThÃªm' }}</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
